<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的个人网站 - 测试</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/test.css">
</head>
<body>
    <header>
        <h1>欢迎来到我的个人网站</h1>
        <nav>
            <li><a href="about.html">关于我</a></li>
            <li><a href="portfolio.html">作品集</a></li>
            <li><a href="contact.html">联系方式</a></li>
            <li id="user-authentication-status">
                <!-- 如果用户已登录，则显示邮箱 -->
                <a href="myprofile.html" id="user-email-link" class="user-email hidden">个人主页</a>
                <!-- 如果用户未登录，则显示登录和注册链接 -->
                <a href="login.html" id="login-link">登录</a>
                <a href="register.html" id="register-link">注册</a>
                <a href="#" id="logout-link" class="hidden">退出登录</a>
            </li>
        </nav>
    </header>
    
    <main>        
        <!-- 快乐度测试内容 -->
        <div class="container">
          <form id="quiz-form">
            <div class="container">
                <h1>开心程度测试</h1>
                <form id="quiz-form">
                  <!-- 问题1 -->
                  <div class="question">
                    <p>1、当你遇到困难时，你的第一反应是什么？</p>
                    <label class="option">
                      <input type="radio" name="q1" value="1">
                      沮丧和失望
                    </label>
                    <label class="option">
                      <input type="radio" name="q1" value="2">
                      焦虑和不安
                    </label>
                    <label class="option">
                      <input type="radio" name="q1" value="3">
                      探索解决方案
                    </label>
                    <label class="option">
                      <input type="radio" name="q1" value="4">
                      乐观并相信自己能够克服
                    </label>
                  </div>
              
                  <!-- 问题2 -->
                  <div class="question">
                    <p>2、你如何看待生活中的小幸福？</p>
                    <label class="option">
                      <input type="radio" name="q2" value="1">
                      不太关注
                    </label>
                    <label class="option">
                      <input type="radio" name="q2" value="2">
                      认为是暂时的
                    </label>
                    <label class="option">
                      <input type="radio" name="q2" value="3">
                      享受但不过分重视
                    </label>
                    <label class="option">
                      <input type="radio" name="q2" value="4">
                      非常珍惜并感到满足
                    </label>
                  </div>
              
                  <!-- 问题3 -->
                  <div class="question">
                    <p>3、你如何看待自己的未来？</p>
                    <label class="option">
                      <input type="radio" name="q3" value="1">
                      悲观，认为不会有什么改变
                    </label>
                    <label class="option">
                      <input type="radio" name="q3" value="2">
                      担忧，但有一些希望
                    </label>
                    <label class="option">
                      <input type="radio" name="q3" value="3">
                      期待，相信自己能够实现目标
                    </label>
                    <label class="option">
                      <input type="radio" name="q3" value="4">
                      非常乐观，充满期待
                    </label>
                  </div>
              
                  <!-- 问题4 -->
                  <div class="question">
                    <p>4、你如何处理失败？</p>
                    <label class="option">
                      <input type="radio" name="q4" value="1">
                      放弃，认为自己不够好
                    </label>
                    <label class="option">
                      <input type="radio" name="q4" value="2">
                      感到失望，但尝试再次尝试
                    </label>
                    <label class="option">
                      <input type="radio" name="q4" value="3">
                      分析原因，制定改进计划
                    </label>
                    <label class="option">
                      <input type="radio" name="q4" value="4">
                      视为学习机会，积极寻求成长
                    </label>
                  </div>
              
                  <!-- 问题5 -->
                  <div class="question">
                    <p>5、你对周围人的态度是怎样的？</p>
                    <label class="option">
                      <input type="radio" name="q5" value="1">
                      冷漠，不太关心他人
                    </label>
                    <label class="option">
                      <input type="radio" name="q5" value="2">
                      保持距离，只在必要时互动
                    </label>
                    <label class="option">
                      <input type="radio" name="q5" value="3">
                      友好，乐于帮助他人
                    </label>
                    <label class="option">
                      <input type="radio" name="q5" value="4">
                      热情，经常主动帮助和支持他人
                    </label>
                  </div>
                            
                                <!-- 问题6 -->
                <div class="question">
                    <p>6、你如何看待自己的健康？</p>
                    <label class="option">
                    <input type="radio" name="q6" value="1">
                    忽略，不太关心
                    </label>
                    <label class="option">
                    <input type="radio" name="q6" value="2">
                    担心，但没有采取太多行动
                    </label>
                    <label class="option">
                    <input type="radio" name="q6" value="3">
                    重视，定期进行健康检查
                    </label>
                    <label class="option">
                    <input type="radio" name="q6" value="4">
                    非常重视，积极锻炼和保持健康饮食
                    </label>
                </div>
                
                <!-- 问题7 -->
                <div class="question">
                    <p>7、你如何应对压力？</p>
                    <label class="option">
                    <input type="radio" name="q7" value="1">
                    逃避，不去面对
                    </label>
                    <label class="option">
                    <input type="radio" name="q7" value="2">
                    感到不安，但尝试应对
                    </label>
                    <label class="option">
                    <input type="radio" name="q7" value="3">
                    寻求支持，与他人交流
                    </label>
                    <label class="option">
                    <input type="radio" name="q7" value="4">
                    使用有效的压力管理技巧
                    </label>
                </div>
                
                <!-- 问题8 -->
                <div class="question">
                    <p>8、你对自己的工作/学习满意吗？</p>
                    <label class="option">
                    <input type="radio" name="q8" value="1">
                    非常不满意
                    </label>
                    <label class="option">
                    <input type="radio" name="q8" value="2">
                    有些不满意，但能忍受
                    </label>
                    <label class="option">
                    <input type="radio" name="q8" value="3">
                    满意，有一些挑战和成长机会
                    </label>
                    <label class="option">
                    <input type="radio" name="q8" value="4">
                    非常满意，感到充实和有成就感
                    </label>
                </div>
                
                <!-- 问题9 -->
                <div class="question">
                    <p>9、你如何看待自己的社交生活？</p>
                    <label class="option">
                    <input type="radio" name="q9" value="1">
                    孤独，很少与人交往
                    </label>
                    <label class="option">
                    <input type="radio" name="q9" value="2">
                    偶尔社交，但不太多
                    </label>
                    <label class="option">
                    <input type="radio" name="q9" value="3">
                    有一些固定的社交活动
                    </label>
                    <label class="option">
                    <input type="radio" name="q9" value="4">
                    经常参与社交活动，感到快乐和满足
                    </label>
                </div>
                
                <!-- 问题10 -->
                <div class="question">
                    <p>10、你如何评价自己的学习与成长态度？</p>
                    <label class="option">
                    <input type="radio" name="q10" value="1">
                    很少学习，对个人成长不感兴趣
                    </label>
                    <label class="option">
                    <input type="radio" name="q10" value="2">
                    偶尔学习，但缺乏持续的动力
                    </label>
                    <label class="option">
                    <input type="radio" name="q10" value="3">
                    定期学习，对个人成长有一定的重视
                    </label>
                    <label class="option">
                    <input type="radio" name="q10" value="4">
                    非常积极，总是寻找机会学习和成长
                    </label>
                </div>
                    
            <!-- 提交按钮 -->
            <button type="button" class="submit-btn" onclick="submitQuiz()">提交答案</button>
          </form>
        </div>
    </main>

    <footer>
        <p>版权所有 &copy; 2024 我的个人网站</p>
        <p>联系邮箱: email@example.com | <a href="https://github.com/yourusername">GitHub</a></p>
    </footer>
    <script src="js/test_before_game.js"></script>
    <script>
        async function saveScoreToServer(username, score) {
            try {
                const response = await fetch('http://localhost:3000/saveTestResult', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, score })
                });

                if (!response.ok) throw new Error('Failed to save data to server.');
                
                const data = await response.json();
                console.log('Data saved successfully with ID:', data.id);
                return true; // 成功保存
            } catch (error) {
                console.error('Error saving data to server:', error);
                return false; // 保存失败
            }
        }

        function evaluateAndSaveScore() {
            let score = 0;
            const form = document.getElementById('quiz-form');
            const radioButtons = form.querySelectorAll('input[type="radio"]:checked');
          
            radioButtons.forEach(radio => {
                score += parseInt(radio.value);
            });
          
            let message;
            if (score >= 41) {
                message = '您非常开心，生活态度积极，能够很好地应对生活中的挑战。您可以放松地玩笑脸识别游戏';
            } else if (score >= 31) {
                message = '您比较开心，生活态度积极，但仍有提升幸福感的潜力。在闲暇时刻，请多尝试笑脸识别游戏';
            } else if (score >= 21) {
                message = '您一般，有一些开心和满足的时刻，但也有改进的空间。请多尝试笑脸识别游戏';
            } else {
                message = '您不开心，可能需要关注和改善自己的心理状态。 请多尝试笑脸识别游戏';
            }
            
            alert('您的得分是：' + score + '\n' + message);

            // 假设有一个默认的用户名
            const username = localStorage.getItem('email') || 'default_user';
            
            (async () => {
                try {
                    const isSaved = await saveScoreToServer(username, score);
                    if (isSaved) {
                        alert('成绩已成功保存！');
                    } else {
                        alert('成绩保存失败，请稍后再试。');
                    }
                } catch (error) {
                    alert('保存过程中发生错误，请重试。');
                    console.error('Error during saving:', error);
                }
            })();
        }

        // 绑定提交按钮的点击事件
        document.querySelector('.submit-btn').addEventListener('click', evaluateAndSaveScore);
      </script>
    </script>
    <script src="js/getprogress.js"></script>
</body>
</html>
